{"ast":null,"code":"import _createForOfIteratorHelper from \"/Users/luiscotto/Documents/Projects/CS-470/practice/lafs-web/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _classCallCheck from \"/Users/luiscotto/Documents/Projects/CS-470/practice/lafs-web/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/luiscotto/Documents/Projects/CS-470/practice/lafs-web/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { ActivatedRoute } from '@angular/router';\nimport { QuestionsService } from '../services/questions.service';\nimport { AnswersService } from '../services/answers.service';\nimport { MatDialog } from '@angular/material';\nimport { DeleteQuestionModalComponent } from './delete-question/delete-question-modal.component';\nimport { NewQuestionModalComponent } from './new-question/new-question-modal.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../services/questions.service\";\nimport * as i3 from \"../services/answers.service\";\nimport * as i4 from \"@angular/material\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/material/core\";\n\nvar _c0 = function _c0(a1) {\n  return [\"/question/\", a1];\n};\n\nfunction CategoryQuestionsComponent_mat_list_item_7_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r3 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"mat-list-item\", 6)(1, \"h3\", 7)(2, \"a\", 8);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"p\", 9)(5, \"i\", 10);\n    i0.ɵɵlistener(\"click\", function CategoryQuestionsComponent_mat_list_item_7_Template_i_click_5_listener() {\n      var restoredCtx = i0.ɵɵrestoreView(_r3);\n      var question_r1 = restoredCtx.$implicit;\n      var ctx_r2 = i0.ɵɵnextContext();\n      return ctx_r2.addPositiveVote(question_r1);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"span\", 11);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"i\", 12);\n    i0.ɵɵlistener(\"click\", function CategoryQuestionsComponent_mat_list_item_7_Template_i_click_8_listener() {\n      var restoredCtx = i0.ɵɵrestoreView(_r3);\n      var question_r1 = restoredCtx.$implicit;\n      var ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.addNegativeVote(question_r1);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"span\", 11);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"i\", 13);\n    i0.ɵɵlistener(\"click\", function CategoryQuestionsComponent_mat_list_item_7_Template_i_click_11_listener() {\n      var restoredCtx = i0.ɵɵrestoreView(_r3);\n      var question_r1 = restoredCtx.$implicit;\n      var ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.delete(question_r1.id);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(12, \"span\", 11);\n    i0.ɵɵelementStart(13, \"span\", 11);\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    var question_r1 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(5, _c0, question_r1.questionSlug));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(question_r1.question);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(question_r1.positiveVotes);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(question_r1.negativeVotes);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"\", question_r1.answers ? question_r1.answers.length : 0, \" Answers\");\n  }\n}\n\nexport var CategoryQuestionsComponent = /*#__PURE__*/(function () {\n  var CategoryQuestionsComponent = /*#__PURE__*/function () {\n    function CategoryQuestionsComponent(route, questionsService, answersService, dialog) {\n      _classCallCheck(this, CategoryQuestionsComponent);\n\n      this.route = route;\n      this.questionsService = questionsService;\n      this.answersService = answersService;\n      this.dialog = dialog;\n    }\n\n    _createClass(CategoryQuestionsComponent, [{\n      key: \"ngOnInit\",\n      value: function ngOnInit() {\n        var _this = this;\n\n        this.route.data.subscribe(function (routeData) {\n          var data = routeData['data'];\n\n          if (data) {\n            _this.questions = data.questions;\n            _this.categoryTitle = data.category_title;\n            _this.categorySlug = data.category_slug;\n          }\n        });\n      }\n    }, {\n      key: \"getQuestions\",\n      value: function getQuestions() {\n        var _this2 = this;\n\n        this.questionsService.getQuestionsByCategory(this.categorySlug).then(function (questions) {\n          return _this2.questions = questions;\n        });\n      }\n    }, {\n      key: \"openNewQuestionModal\",\n      value: function openNewQuestionModal(categorySlug) {\n        var _this3 = this;\n\n        var dialogRef = this.dialog.open(NewQuestionModalComponent, {\n          data: {\n            categorySlug: categorySlug\n          }\n        });\n        dialogRef.afterClosed().subscribe(function (question) {\n          if (question) {\n            _this3.addQuestionToList(question);\n          }\n        });\n      }\n    }, {\n      key: \"delete\",\n      value: function _delete(questionId) {\n        var _this4 = this;\n\n        var dialogRef = this.dialog.open(DeleteQuestionModalComponent, {\n          data: {\n            questionId: questionId\n          }\n        });\n        dialogRef.afterClosed().subscribe(function (confirm) {\n          if (confirm) {\n            // refresh the questions list\n            var index = _this4.questions.findIndex(function (question) {\n              return question.id === questionId;\n            });\n\n            _this4.questions.splice(index, 1); // TODO: evaluar cambiar esto por un operation method en loopback.\n\n\n            _this4.answersService.getAnswers(questionId).then(function (answers) {\n              var _iterator = _createForOfIteratorHelper(answers),\n                  _step;\n\n              try {\n                for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                  var answer = _step.value;\n\n                  _this4.answersService.deleteAnswer(answer.id);\n                }\n              } catch (err) {\n                _iterator.e(err);\n              } finally {\n                _iterator.f();\n              }\n            });\n          }\n        });\n      }\n    }, {\n      key: \"addQuestionToList\",\n      value: function addQuestionToList(question) {\n        this.questions.push(question);\n      }\n    }, {\n      key: \"addPositiveVote\",\n      value: function addPositiveVote(question) {\n        question.positiveVotes += 1;\n        this.questionsService.updateQuestion(question);\n      }\n    }, {\n      key: \"addNegativeVote\",\n      value: function addNegativeVote(question) {\n        question.negativeVotes += 1;\n        this.questionsService.updateQuestion(question);\n      }\n    }]);\n\n    return CategoryQuestionsComponent;\n  }();\n\n  CategoryQuestionsComponent.ɵfac = function CategoryQuestionsComponent_Factory(t) {\n    return new (t || CategoryQuestionsComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.QuestionsService), i0.ɵɵdirectiveInject(i3.AnswersService), i0.ɵɵdirectiveInject(i4.MatDialog));\n  };\n\n  CategoryQuestionsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CategoryQuestionsComponent,\n    selectors: [[\"category-questions\"]],\n    decls: 8,\n    vars: 2,\n    consts: [[1, \"col-lg-12\", \"category-questions\"], [1, \"card\", \"col-md-offset-2\", \"col-md-8\"], [1, \"list-title\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [1, \"list\"], [\"class\", \"list-item\", 4, \"ngFor\", \"ngForOf\"], [1, \"list-item\"], [\"matLine\", \"\"], [3, \"routerLink\"], [\"matLine\", \"\", 1, \"icons-line\"], [\"aria-hidden\", \"true\", 1, \"list-single-icon\", \"fa\", \"fa-thumbs-o-up\", 3, \"click\"], [1, \"list-single-icon-number\"], [1, \"list-single-icon\", \"fa\", \"fa-thumbs-o-down\", 3, \"click\"], [1, \"list-single-icon\", \"fa\", \"fa\", \"fa-trash-o\", 3, \"click\"]],\n    template: function CategoryQuestionsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h3\", 2);\n        i0.ɵɵtext(3);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"button\", 3);\n        i0.ɵɵlistener(\"click\", function CategoryQuestionsComponent_Template_button_click_4_listener() {\n          return ctx.openNewQuestionModal(ctx.categorySlug);\n        });\n        i0.ɵɵtext(5, \"New Question\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"mat-list\", 4);\n        i0.ɵɵtemplate(7, CategoryQuestionsComponent_mat_list_item_7_Template, 15, 7, \"mat-list-item\", 5);\n        i0.ɵɵelementEnd()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\"Learn about: \", ctx.categoryTitle, \"\");\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngForOf\", ctx.questions);\n      }\n    },\n    directives: [i4.MatButton, i4.MatList, i5.NgForOf, i4.MatListItem, i6.MatLine, i1.RouterLinkWithHref],\n    styles: [\".category-questions[_ngcontent-%COMP%]   .list[_ngcontent-%COMP%]{margin-top:30px}.category-questions[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{margin-bottom:10px}.category-questions[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:not(:first-child){border-top:1px solid #e1e1e1}.category-questions[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .icons-line[_ngcontent-%COMP%]{margin-top:10px}.category-questions[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .icons-line[_ngcontent-%COMP%]   .list-single-icon[_ngcontent-%COMP%]{color:#555;font-size:20px}.category-questions[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .icons-line[_ngcontent-%COMP%]   .list-single-icon-number[_ngcontent-%COMP%]{color:#555;vertical-align:top}.category-questions[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]   .icons-line[_ngcontent-%COMP%]   .list-single-icon-number[_ngcontent-%COMP%]:not(:last-child){margin-right:15px}\"]\n  });\n  return CategoryQuestionsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}